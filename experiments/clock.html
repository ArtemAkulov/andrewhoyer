---
layout: minimal
permalink: /clock/
js:
    - modernizr-1.6.min.js
---

<style type="text/css" media="screen">

body {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: black;
}

div.screen {
    position: absolute;
    height: 100%;
    width: 100%;
    -webkit-perspective: 500;
    -webkit-transform-style: preserve-3d;
    -webkit-user-select: none;
    cursor: move;
}

div.clock-wrapper {
    position: absolute;
    top: 10%;
    right: 10%;
    bottom: 10%;
    left: 10%;
}

div.clock-wrapper div {
    position: absolute;
}

div.clock {
    position: relative;
    margin-top: 50%;
    margin-left: 50%;
    -webkit-transform-style: preserve-3d;
}

div.clock.autopilot {
    -webkit-transition: -webkit-transform 1750ms ease-in-out;
}

div.clock div {
    -webkit-transform-style: preserve-3d;
}

div.top, div.right, div.bottom, div.left {
    background: #777;
    height: 100%;
    width: 100%;
}

div.top {
    top: 0;
    -webkit-transform: rotateX(-90deg);
    -webkit-transform-origin: 0 0;
}

div.right {
    top: 0;
    right: 0;
    -webkit-transform: rotateY(-90deg);
    -webkit-transform-origin: 100% 0;
}

div.bottom {
    bottom: 0;
    -webkit-transform: rotateX(90deg);
    -webkit-transform-origin: 0 100%;
}

div.left {
    -webkit-transform: rotateY(90deg);
    -webkit-transform-origin: 0 0;
}

div.facets {
    width: 100%;
    height: 100%;
}

div.facets > div {
    top: 0%;
    left: 36.7%;
    right: 36.7%;
    height: 4%;
    background: white;
    -webkit-transform-origin: 50% 1250%;
}

div.facets > div:nth-child(1){ -webkit-transform: rotate(15deg); }
div.facets > div:nth-child(2){ -webkit-transform: rotate(45deg); }
div.facets > div:nth-child(3){ -webkit-transform: rotate(75deg); }
div.facets > div:nth-child(4){ -webkit-transform: rotate(105deg); }
div.facets > div:nth-child(5){ -webkit-transform: rotate(135deg); }
div.facets > div:nth-child(6){ -webkit-transform: rotate(165deg); }
div.facets > div:nth-child(7){ -webkit-transform: rotate(195deg); }
div.facets > div:nth-child(8){ -webkit-transform: rotate(225deg); }
div.facets > div:nth-child(9){ -webkit-transform: rotate(255deg); }
div.facets > div:nth-child(10){ -webkit-transform: rotate(285deg); }
div.facets > div:nth-child(11){ -webkit-transform: rotate(315deg); }
div.facets > div:nth-child(12){ -webkit-transform: rotate(345deg); }

div.pin {
    top: 46%;
    right: 46%;
    bottom: 46%;
    left: 46%;
}

div.pin > div {
    background: white;
    left: 22%;
    right: 22%;
    height: 100%;
}

div.pin > div:nth-child(1){ -webkit-transform: rotate(0deg); }
div.pin > div:nth-child(2){ -webkit-transform: rotate(60deg); }
div.pin > div:nth-child(3){ -webkit-transform: rotate(120deg); }

div.pin div.top,
div.pin div.bottom {
    height: 45%;
    width: 100%;
}

div.hands {
    top: 8%;
    right: 46%;
    bottom: 50%;
    left: 46%;
}

div.hands > div {
    bottom: 0;
    background: white;
    -webkit-transform-origin: 50% 100%;
}

div.hands > div.hour {
    top: 30%;
    right: 20%;
    left: 20%;
}

div.hands > div.hour div.top {
    height: 14%;
}

div.hands > div.hour div.right,
div.hands > div.hour div.left {
    width: 75%;
    height: 100%;
}

div.hands > div.minute {
    top: 0;
    right: 32%;
    left: 32%;
}

div.hands > div.minute div.top {
    height: 10%;
}

div.hands > div.minute div.right,
div.hands > div.minute div.left {
    width: 115%;
    height: 100%;
}

div.hands > div.second {
    top: 0;
    right: 45%;
    left: 45%;
}

div.hands > div.second div.top {
    height: 9%;
}

div.hands > div.second div.right,
div.hands > div.second div.left {
    width: 470%;
    height: 100%;
}

</style>

<div class="screen">
    
    <div class="clock-wrapper">
        <div class="clock">
            
            <div class="facets">
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
            </div>
            
            <div class="pin">
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
                <div> <div class="top"></div> <div class="bottom"></div> </div>
            </div>
            
            <div class="hands">
                <div class="hour"> <div class="top"></div> <div class="right"></div> <div class="left"></div> </div>
                <div class="minute"> <div class="top"></div> <div class="right"></div> <div class="left"></div> </div>
                <div class="second"> <div class="top"></div> <div class="right"></div> <div class="left"></div> </div>
            </div>
            
        </div>
    </div>
    
</div>

<script type="text/javascript" charset="utf-8">

(function(){

Function.prototype.wait = function(delay){
    var self = this, timer;
    
    return function(){
        var args = arguments;
        if (!timer) timer = setTimeout(function(){
            timer = clearTimeout(timer);
            self.apply(self, args);
        }, delay || 50);
    };
};

Array.slice = function(){
    var slice = Array.prototype.slice;
    return slice.apply(arguments[0], slice.call(arguments, 1));
};

var methods = {
    
    rotate: function(value){
        this.style[CSS.transform] = 'rotate(' + (value * 360) + 'deg)';
    },
    
    rotate3d: function(x, y, z, deg){
        this.style[CSS.transform] = 'rotate3d(' + [x, y, z, deg + 'deg'].join(',') + ')';
    },
    
    addClass: function(){
        var existing = this.className.split(' ');
        
        Array.slice(arguments).forEach(function(className){
            if (existing.indexOf(className) < 0) existing.push(className);
        });
        
        this.className = existing.join(' ');
    },
    
    removeClass: function(){
        var existing = this.className.split(' '),
            args = Array.slice(arguments);
        
        this.className = existing.filter(function(className){
            return args.indexOf(className) < 0;
        }).join(' ');
    }
    
};

for(var method in methods){
    HTMLElement.prototype[method] = methods[method];
}

})(); // end prototype modifications.

var Helper = {
    cap: function(value, min, max){
        return Math.min(Math.max(value, min), max);
    }
};

var Generator = {
    random: function(min, max){
        return Math.random() * (max - min) + min;
    }
};

var Clock = function(){
    this.max_rotation = 80;
    
    this.elements = {
        wrapper: document.querySelector('div.clock-wrapper'),
        clock: document.querySelector('div.clock'),
        hour: document.querySelector('div.hands div.hour'),
        minute: document.querySelector('div.hands div.minute'),
        second: document.querySelector('div.hands div.second')
    };
    
    this.tick();
    setInterval(this.tick.bind(this), 1000);
    
    this.initResize();
    this.initInteraction();
};

Clock.prototype = {
    
    tick: function(){
        var time = new Date(),
            millis = time.getMilliseconds(),
            seconds = this.toMillis('second', time.getSeconds()) + millis,
            minutes = this.toMillis('minute', time.getMinutes()),
            hours = this.toMillis('hour', time.getHours() % 12),
            elements = this.elements;
        
        elements.second.rotate(this.toFraction('second', seconds));
        elements.minute.rotate(this.toFraction('minute', minutes + seconds));
        elements.hour.rotate(this.toFraction('hour', hours + minutes + seconds));
    },
    
    toMillis: function(unit, time){
        var times = ['second', 'minute', 'hour'].indexOf(unit);
        for (time *= 1000; times > 0; time *= 60, times--);
        return time;
    },
    
    toFraction: function(unit, time){
        time /= 60000;
        switch (unit){
            case 'second': break;
            case 'hour': time /= 12;
            default: time /= 60;
        }
        return time;
    },
    
    initResize: function(){
        var wrapper = this.elements.wrapper,
            clock = this.elements.clock;
        
        var resize = function(){
            var style = clock.style,
                dimension = Math.min(wrapper.clientWidth, wrapper.clientHeight);
            
            style.left = style.top = (-dimension / 2) + 'px';
            style.height = style.width = dimension + 'px';
            
            clock.top = clock.offsetTop + wrapper.offsetTop;
            clock.left = clock.offsetLeft + wrapper.offsetLeft;
            clock.halfWidth = dimension / 2;
            clock.halfHeight = dimension / 2;
            
            return resize;
        };
        
        window.addEventListener('resize', resize(), false);
    },
    
    initInteraction: function(){
        var clock = this.elements.clock,
            changePerspective = this.changePerspective.bind(this),
            movementTimer, autopilotTimer;
        
        // check every 5 seconds if there has been any user interaction.
        // if not, start moving the clock for them.
        var movement = function(){
            
            clock.removeClass('autopilot');
            
            clearTimeout(movementTimer);
            clearInterval(autopilotTimer);
            
            movementTimer = setTimeout(function(){
                
                clock.addClass('autopilot');
                
                clearInterval(autopilotTimer);
                
                autopilotTimer = setInterval(function(){
                    var x = Generator.random(-1, 1),
                        y = Generator.random(-1, 1);
                    changePerspective(x, y);
                }, 2000);
                
            }, 5000);
            
        };
        
        movement(); // get the ball rolling...
        
        var calculatePerspective = function(event){
            movement();
            
            var width = clock.halfWidth,
                height = clock.halfHeight;
            
            var x = (event.clientX - clock.left - width) / width;
            var y = (event.clientY - clock.top - height) / height;
            
            changePerspective(Helper.cap(x, -1, 1), Helper.cap(y, -1, 1));
            
            return calculatePerspective;
        };
        
        document.addEventListener('mousedown', function(event){
            document.addEventListener('mousemove', calculatePerspective(event), false);
        }, false);
        
        document.addEventListener('mouseup', function(){
            document.removeEventListener('mousemove', calculatePerspective, false);
        }, false);
    },
    
    changePerspective: function(x, y){
        var scale = Math.min(Math.sqrt(x * x + y * y), 1);
        this.elements.clock.rotate3d(-y, x, 0, scale * this.max_rotation);
    }
    
};

document.addEventListener('DOMContentLoaded', function(){
    
    if (Modernizr.csstransforms3d){
        new Clock();
    } else {
        // Display an incompatibility message
    }
    
}, false);

</script>
