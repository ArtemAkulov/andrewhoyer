---
layout: default
permalink: /text/
---
<style type="text/css" media="screen">
	#canvas {
		height: 300px;
		border: 1px solid black;
	}
	
	#canvas pre {
		border: none;
		overflow: visible;
	}
	
	canvas {
		border: 1px solid black;
		background: white;
	}
</style>

<div id='canvas'></div>
<script type="text/javascript" charset="utf-8">

var twoD = function(width, height, init){
	var array = [];
	
	for (var i = 0; i < height; i++){
		array[i] = [];
		for (var j = 0; j < width; j++)
			array[i][j] = init;
	}
	
	return array;
};

var Screen = new Class({
	
	initialize: function(array){
		this.width = width;
		this.height = height;
		
		for (var i = 0, data = this.data = []; i < height; i++){
			data[i] = [];
			for (var j = 0; j < width; j++)
				data[i][j] = val;
		}
	},
	
	serialize: function(){
		var height = this.height,
			string = '';
		
		for (var i = 0; i < height; i++)
			string += this.data[i].join('') + '\n';
		
		return string;
	}
	
});

var TextCanvas = new Class({
	
	map: ' .,lIi1t7rfunvJc23ohY4C0TLVax5eDb6F9HkPsAEORSw8UmKGdWMXBN'.split(''),
	
	initialize: function(id, width, height){
		
		this.canvas = new Screen(width, height, this.map.getLast());
		this.map_length = this.map.length;
		this.width = width;
		this.height = height;
		
		var container = this.container = document.id(id).setStyle('position', 'relative');
		
		var element = this.element = new Element('pre', {
			'styles': {
				'position': 'absolute',
				'top': 0, 'left': 0,
				'color': 'black',
				'font-size': '8px',
				'font-family': 'courier',
				'line-height': '0.5em',
				'letter-spacing': 0
			},
			'text': this.canvas.serialize()
		}).inject(container);
	},
	
	set: function(x, y, color){
		this.canvas.set(x, y, this.map[(this.map_length * color / 255).floor()]);
	},
	
	refresh: function(){
		this.element.set('text', this.canvas.serialize());
	}
	
});

var FluidSimulation = new Class({
	
	initialize: function(width, height){
		this.dt = 35;
		this.diff = 0.5;
		this.width = width;
		this.height = height;
		
		var velocity = this.velocity = {};
		['current_x', 'current_y', 'previous_x', 'previous_y'].each(function(name){
			velocity[name] = twoD(width + 2, height + 2);
		});
		
		var density = this.density = {};
		['current', 'previous'].each(function(name){
			density[name] = twoD(width + 2, height + 2);
		});
	},
	
	diffuse: function(N, b, x, x0, diff, dt){
		var height = this.height,
			width = this.width,
			a = this.dt * diff * width * height,
			i, j, k;
		
		for (k = 0; k < 20; k++){
			for(i = 1; i < height; i++)
				for (j = 1; j < width; j++)
					x[i][j] = (x0[i][j] + a * (x[i - 1][j] + x[i + 1][j] + x[i][j - 1] + x[i][j + 1])) / (1 + 4 * a);
			
			// this.setBoundary( N, b, x );
		}
	},
	
	advect: function(){
		
	},
	
	setBoundary: function(){
		
	},
	
	add_source: function(){
		add_source ( N, x, x0, dt );
		
		SWAP ( x0, x );
		diffuse ( N, 0, x, x0, diff, dt );
		
		SWAP ( x0, x );
		advect ( N, 0, x, x0, u, v, dt );
	},
	
	vel_step: function(){
		var size = this.size;
		add_source ( N, u, u0, dt );
		add_source ( N, v, v0, dt );
		
		SWAP ( u0, u );
		diffuse ( N, 1, u, u0, visc, dt );
		
		SWAP ( v0, v );
		diffuse ( N, 2, v, v0, visc, dt );
		
		project ( N, u, v, u0, v0 );
		
		SWAP ( u0, u ); SWAP ( v0, v );
		advect ( N, 1, u, u0, u0, v0, dt );
		advect ( N, 2, v, v0, u0, v0, dt );
		
		project ( N, u, v, u0, v0 );
	},
	
	dens_step: function(){
		
	},
	
	draw: function(){
		
	},
	
	run: function(){
		// get_from_UI( dens_prev, x_prev, y_prevprev );
		//this.update_velocity(); // vel_step( N, x, y, x_prev, y_prev, visc, dt );
		//this.update_density(); // dens_step( N, dens, dens_prev, x, y, diff, dt );
		//this.draw(); // draw_dens( N, dens );
	}
	
});
// 

var width = 100, height = 30;
var sim = new FluidSimulation(width, height);

// setInterval(function(){
// 	for (var i = num; i--;)
// 		canvas.set($random(0, width-1), $random(0, height-1), $random(0,254));
// 	canvas.refresh();
// }, 10);

/*
Our universe consists of between 30 to 50 billion trillion stars, arranged in 80 to 140  billion galaxies. Our nearest neighbouring star is called proximus centauri and is 4 light years away. We need some bread, but its really hot outside and I can't be bothered to walk around the corner.
*/

</script>


